# ğŸ“Š Diagrama de Flujo Completo: Frontend â†’ Backend â†’ N8N â†’ ConfirmaciÃ³n

```
â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘                                                                              â•‘
â•‘                      FLUJO COMPLETO: REPOGEMIN â†’ CONFIRMACIÃ“N               â•‘
â•‘                                                                              â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•


â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  PASO 1: REPOGEMIN (Frontend del Empleado)                                  â”‚
â”‚  URL: https://repogemin.vercel.app (o frontend local)                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Step 1: CÃ©dula   â”‚  Usuario ingresa su cÃ©dula
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â”‚ Verifica en BD / Excel
         â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Step 2: Bloqueos â”‚  GET /verificar-bloqueo/{cedula}
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  Â¿Hay caso incompleto?
         â”‚
    â”Œâ”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”
    â”‚           â”‚
  SÃ âœ—         NO âœ“
    â”‚           â”‚
    â”‚      â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚      â”‚ Step 3: Tipo          â”‚
    â”‚      â”‚ Selecciona tipo       â”‚
    â”‚      â”‚ (maternity, general,  â”‚
    â”‚      â”‚  labor, traffic...)   â”‚
    â”‚      â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â”‚           â”‚
    â”‚      â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚      â”‚ Step 4: InformaciÃ³n   â”‚
    â”‚      â”‚ Email, TelÃ©fono       â”‚
    â”‚      â”‚ Datos especÃ­ficos      â”‚
    â”‚      â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â”‚           â”‚
    â”‚      â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚      â”‚ Step 5: Documentos    â”‚
    â”‚      â”‚ Sube PDFs mÃºltiples   â”‚
    â”‚      â”‚ Valida calidad        â”‚
    â”‚      â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â”‚           â”‚
    â”‚      â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚      â”‚ Step 5.5: Fechas      â”‚
    â”‚      â”‚ Fecha inicio/fin      â”‚
    â”‚      â”‚ De los documentos     â”‚
    â”‚      â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â”‚           â”‚
    â”‚      â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚      â”‚ Step 6: Contacto      â”‚
    â”‚      â”‚ Confirma email/tel    â”‚
    â”‚      â”‚ Genera preview        â”‚
    â”‚      â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â”‚           â”‚
    â”‚      â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚      â”‚ ENVIAR FORMULARIO     â”‚
    â”‚      â”‚ POST /subir-          â”‚
    â”‚      â”‚ incapacidad/          â”‚
    â”‚      â”‚                       â”‚
    â”‚      â”‚ FormData:             â”‚
    â”‚      â”‚ â”œâ”€ cedula             â”‚
    â”‚      â”‚ â”œâ”€ tipo               â”‚
    â”‚      â”‚ â”œâ”€ email              â”‚
    â”‚      â”‚ â”œâ”€ telefono           â”‚
    â”‚      â”‚ â”œâ”€ archivos (PDFs)    â”‚
    â”‚      â”‚ â”œâ”€ startDate          â”‚
    â”‚      â”‚ â””â”€ endDate            â”‚
    â”‚      â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â”‚           â”‚
    â–¼           â”‚
 â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
 â”‚ PANTALLA DE  â”‚                  â”‚
 â”‚ BLOQUEO      â”‚     (continÃºa â†’)  â”‚
 â”‚              â”‚                  â”‚
 â”‚ ğŸ”’ Bloqueado â”‚                  â”‚
 â”‚              â”‚                  â”‚
 â”‚ Caso: {serial}
 â”‚ Estado: INCOMPLETA
 â”‚ Falta: {checks}
 â”‚              â”‚                  â”‚
 â”‚ [Completar]  â”‚                  â”‚
 â”‚              â”‚                  â”‚
 â”‚ Si click:    â”‚                  â”‚
 â”‚ POST /casos/ â”‚                  â”‚
 â”‚ {serial}/    â”‚                  â”‚
 â”‚ completar    â”‚                  â”‚
 â”‚              â”‚                  â”‚
 â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜


â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  PASO 2: BACKEND (app/main.py - POST /subir-incapacidad/)                   â”‚
â”‚  URL: https://web-production-95ed.up.railway.app                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 1. Recibe FormData                               â”‚
â”‚    â”œâ”€ cedula: "1085043374"                       â”‚
â”‚    â”œâ”€ email: "employee@company.com"              â”‚
â”‚    â”œâ”€ telefono: "3001234567"                     â”‚
â”‚    â”œâ”€ tipo: "general"                            â”‚
â”‚    â”œâ”€ startDate: "2026-01-15"                    â”‚
â”‚    â”œâ”€ endDate: "2026-01-20"                      â”‚
â”‚    â””â”€ archivos: [PDF, PDF, PDF]                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 2. Verifica bloqueos                             â”‚
â”‚    Case.cedula = cedula                          â”‚
â”‚    Case.bloquea_nueva = True?                    â”‚
â”‚    â””â”€ Si SÃ: Retorna HTTP 409 âŒ               â”‚
â”‚    â””â”€ Si NO: ContinÃºa âœ“                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 3. Detecta reenvÃ­os                              â”‚
â”‚    Busca: cedula + fecha_inicio + INCOMPLETA     â”‚
â”‚    â””â”€ Si existe: es reenvÃ­o                      â”‚
â”‚       Serial: base-R1, base-R2, etc             â”‚
â”‚    â””â”€ Si no: es nuevo                            â”‚
â”‚       Serial: cedula DD MM YYYY DD MM YYYY      â”‚
â”‚       Ej: 1085043374 01 01 2026 01 20 2026     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 4. Procesa archivos                              â”‚
â”‚    â”œâ”€ Merge PDFs                                 â”‚
â”‚    â”œâ”€ Sube a Google Drive                        â”‚
â”‚    â”œâ”€ Obtiene link: drive_link                   â”‚
â”‚    â””â”€ Limpia archivos temporales                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 5. Crea registro en BD                           â”‚
â”‚    Case:                                         â”‚
â”‚    â”œâ”€ serial: "1085043374 01 01 2026 01 20"    â”‚
â”‚    â”œâ”€ cedula: "1085043374"                       â”‚
â”‚    â”œâ”€ estado: NUEVO                              â”‚
â”‚    â”œâ”€ bloquea_nueva: False                       â”‚
â”‚    â”œâ”€ drive_link: "https://drive.google.com/..." â”‚
â”‚    â”œâ”€ email_form: "employee@company.com"         â”‚
â”‚    â”œâ”€ telefono_form: "3001234567"                â”‚
â”‚    â”œâ”€ metadata_form: {...}                       â”‚
â”‚    â””â”€ fecha_inicio, fecha_fin                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 6. Sincroniza con Google Sheets                  â”‚
â”‚    actualizar_caso_en_sheet(caso, accion='crear')â”‚
â”‚    â””â”€ Agrega fila en tracker                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 7. EnvÃ­a a N8N                                   â”‚
â”‚    POST {N8N_WEBHOOK_URL}                        â”‚
â”‚                                                  â”‚
â”‚    {                                             â”‚
â”‚      "tipo_notificacion": "confirmacion",        â”‚
â”‚      "email": "employee@company.com",            â”‚
â”‚      "cc_email": "hr@company.com",               â”‚
â”‚      "serial": "1085043374 01 01 2026...",      â”‚
â”‚      "subject": "Incapacidad...",               â”‚
â”‚      "html_content": "<html>...",                â”‚
â”‚      "whatsapp": "3001234567",                   â”‚
â”‚      "whatsapp_message": "Hola, confirmo..."     â”‚
â”‚    }                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 8. Retorna respuesta                             â”‚
â”‚    HTTP 200 OK                                   â”‚
â”‚    {                                             â”‚
â”‚      "status": "ok",                             â”‚
â”‚      "mensaje": "Registro exitoso",              â”‚
â”‚      "consecutivo": "1085043374...",            â”‚
â”‚      "case_id": 12345,                           â”‚
â”‚      "link_pdf": "https://drive.google.com/..",  â”‚
â”‚      "archivos_combinados": 3,                   â”‚
â”‚      "correos_enviados": ["employee@..."]        â”‚
â”‚    }                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚
             â–¼
    âœ… RESPUESTA AL FRONTEND


â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  PASO 3: N8N (Procesamiento de Notificaciones)                              â”‚
â”‚  URL: https://railway-n8n-production-5a3f.up.railway.app/webhook/           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Webhook N8N recibe JSON                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚                  â”‚
    â–¼                  â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ENVÃA EMAIL     â”‚  â”‚ REGISTRA EN     â”‚
â”‚                 â”‚  â”‚ GOOGLE SHEETS   â”‚
â”‚ Via SMTP:       â”‚  â”‚                 â”‚
â”‚ â”œâ”€ TO:          â”‚  â”‚ Agrega fila:    â”‚
â”‚ â”‚  employee@    â”‚  â”‚ â”œâ”€ serial       â”‚
â”‚ â”‚  company.com  â”‚  â”‚ â”œâ”€ cedula       â”‚
â”‚ â”œâ”€ CC:          â”‚  â”‚ â”œâ”€ email        â”‚
â”‚ â”‚  hr@company   â”‚  â”‚ â”œâ”€ estado       â”‚
â”‚ â”œâ”€ Subject:     â”‚  â”‚ â”œâ”€ timestamp    â”‚
â”‚ â”‚  "Incapacidad â”‚  â”‚ â””â”€ metadata     â”‚
â”‚ â”‚   {serial}"   â”‚  â”‚                 â”‚
â”‚ â””â”€ Body:        â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”‚    HTML templateâ”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚
     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ENVÃA WHATSAPP                                   â”‚
â”‚                                                  â”‚
â”‚ Via Evolution API:                               â”‚
â”‚ â”œâ”€ TO: 3001234567 (WhatsApp)                     â”‚
â”‚ â”œâ”€ Message:                                      â”‚
â”‚ â”‚  "Hola, confirmo recibido de tu documentaciÃ³n" â”‚
â”‚ â”‚  "Serial: 1085043374 01 01 2026 01 20 2026"  â”‚
â”‚ â”‚  "Tu solicitud estÃ¡ siendo revisada"           â”‚
â”‚ â”‚  "Gracias por usar IncaNeurobaeza"             â”‚
â”‚ â””â”€ Status: Enviado âœ“                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜


â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  PASO 4: CONFIRMACIÃ“N EN FRONTEND (REPOGEMIN)                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Frontend procesa respuesta del backend                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚                     â”‚
    â–¼                     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ response.ok == true? â”‚  response.ok == false?
â”‚                   â”‚  â”‚                  â”‚
â”‚ âœ… YES            â”‚  âŒ NO              â”‚
â”‚ setSubmission     â”‚  â”‚  setApiError     â”‚
â”‚ Complete(true)    â”‚  â”‚                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚                      â”‚
         â–¼                      â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ PANTALLA DE      â”‚  â”‚ PANTALLA DE      â”‚
    â”‚ Ã‰XITO âœ…         â”‚  â”‚ ERROR âŒ         â”‚
    â”‚                  â”‚  â”‚                  â”‚
    â”‚ âœ… CheckCircle   â”‚  â”‚ âŒ AlertCircle   â”‚
    â”‚ Icon             â”‚  â”‚ Icon             â”‚
    â”‚                  â”‚  â”‚                  â”‚
    â”‚ "Solicitud       â”‚  â”‚ "Error al        â”‚
    â”‚  enviada con     â”‚  â”‚  procesar"       â”‚
    â”‚  Ã©xito"          â”‚  â”‚                  â”‚
    â”‚                  â”‚  â”‚ "Por favor       â”‚
    â”‚ "Hemos recibido  â”‚  â”‚  intenta de      â”‚
    â”‚  tu solicitud.   â”‚  â”‚  nuevo"          â”‚
    â”‚  Pronto nos      â”‚  â”‚                  â”‚
    â”‚  comunicaremos"  â”‚  â”‚ [Reintentar]     â”‚
    â”‚                  â”‚  â”‚                  â”‚
    â”‚ [Volver al       â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â”‚  inicio]         â”‚
    â”‚                  â”‚
    â”‚ Limpia formularioâ”‚
    â”‚ y vuelve al Step1â”‚
    â”‚                  â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜


â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ESTADO FINAL EN LOS SISTEMAS                                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ BD (Railway PostgreSQL)                                                 â”‚
â”‚ â”œâ”€ Caso creado con serial: "1085043374 01 01 2026 01 20 2026"          â”‚
â”‚ â”œâ”€ estado: NUEVO                                                        â”‚
â”‚ â”œâ”€ bloquea_nueva: False                                                 â”‚
â”‚ â”œâ”€ drive_link: "https://drive.google.com/..."                          â”‚
â”‚ â”œâ”€ Documentos subidos en Drive                                          â”‚
â”‚ â””â”€ CaseEvent registrado                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Google Sheets Tracker                                                   â”‚
â”‚ â”œâ”€ Fila agregada con serial                                             â”‚
â”‚ â”œâ”€ Estado: NUEVO                                                        â”‚
â”‚ â”œâ”€ Fecha de creaciÃ³n                                                    â”‚
â”‚ â””â”€ Link a Drive                                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Portal de Validadores                                                   â”‚
â”‚ â”œâ”€ Caso visible en bÃºsqueda                                             â”‚
â”‚ â”œâ”€ Estado: NUEVO (pendiente revisiÃ³n)                                   â”‚
â”‚ â”œâ”€ PDFs visibles                                                        â”‚
â”‚ â””â”€ Opciones: Cambiar estado, bloquear, agregar notas                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Empleado (Usuario)                                                      â”‚
â”‚ â”œâ”€ âœ… Ve pantalla de Ã©xito en repogemin                                 â”‚
â”‚ â”œâ”€ ğŸ“§ Recibe email de confirmaciÃ³n                                      â”‚
â”‚ â”œâ”€ ğŸ’¬ Recibe WhatsApp de confirmaciÃ³n                                   â”‚
â”‚ â””â”€ âœ… Sabe que su solicitud fue recibida                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜


â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘                                                                            â•‘
â•‘              âœ… FLUJO COMPLETADO EXITOSAMENTE                             â•‘
â•‘                                                                            â•‘
â•‘  El empleado tiene confirmaciÃ³n clara de que:                             â•‘
â•‘  1. âœ… Frontend procesÃ³ sus datos                                         â•‘
â•‘  2. âœ… Backend los recibiÃ³ correctamente                                  â•‘
â•‘  3. âœ… Se generÃ³ serial Ãºnico                                             â•‘
â•‘  4. âœ… Se almacenaron en BD                                               â•‘
â•‘  5. âœ… Se subieron a Drive                                                â•‘
â•‘  6. âœ… Se notificÃ³ a validadores                                          â•‘
â•‘  7. âœ… RecibiÃ³ confirmaciÃ³n por email + WhatsApp                          â•‘
â•‘                                                                            â•‘
â•‘  DuraciÃ³n total: 5-30 segundos                                            â•‘
â•‘                                                                            â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
```

---

## Casos Especiales de Manejo

### Caso 1: Timeout (Frontend espera > 60 segundos)

```
Frontend timeout detectado (AbortError)
â”œâ”€ Pero backend ya retornÃ³ 200 OK
â”œâ”€ Y N8N ya procesÃ³
â”œâ”€ Entonces: considerar como Ã‰XITO
â””â”€ setSubmissionComplete(true)
   â””â”€ Mostrar pantalla de Ã©xito
```

### Caso 2: Bloqueo Activo

```
Empleado intenta enviar nuevo caso
â”œâ”€ GET /verificar-bloqueo/{cedula}
â”œâ”€ Sistema encuentra: bloquea_nueva = True
â”œâ”€ Retorna: "bloqueado": True
â””â”€ Frontend:
   â””â”€ Muestra pantalla de bloqueo (Step 2.5)
      â”œâ”€ Serial del caso pendiente
      â”œâ”€ Checks faltantes
      â””â”€ OpciÃ³n: "Completar esta Incapacidad"
         â””â”€ POST /casos/{serial}/completar
            â””â”€ Detectado como reenvÃ­o (-R1)
```

### Caso 3: ReenvÃ­o

```
Mismo empleado, misma fecha_inicio
â”œâ”€ Backend detecta: cedula + fecha_inicio coinciden
â”œâ”€ Es REENVÃO
â””â”€ Serial generado: "base_serial-R1"
   â”œâ”€ Metadata: "es_reenvio": True
   â”œâ”€ Metadata: "total_reenvios": 1
   â”œâ”€ Metadata: "caso_original_serial": "base_serial"
   â””â”€ Frontend:
      â””â”€ Muestra Ã©xito igual
      â””â”€ Portal validador ve reenvÃ­o
         â””â”€ Puede comparar versiones
            â””â”€ Aprobar o rechazar
```

---

## Testing Checklist

- [ ] Test 1: Usuario completa formulario â†’ recibe Ã©xito
- [ ] Test 2: Usuario bloqueado â†’ ve pantalla de bloqueo
- [ ] Test 3: Usuario reenvÃ­a â†’ detectado como -R1
- [ ] Test 4: Validador busca en portal â†’ ve caso
- [ ] Test 5: Validador marca INCOMPLETA â†’ usuario bloqueado
- [ ] Test 6: Validador marca COMPLETA â†’ usuario desbloqueado
- [ ] Test 7: Email llega a usuario
- [ ] Test 8: WhatsApp llega a usuario
- [ ] Test 9: Sheets tracker actualizado
- [ ] Test 10: Drive tiene PDFs organizados

---

